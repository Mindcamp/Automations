{"blocks":[{"id":"75E76163-A5E6-4386-9A75-D3F92FF85AFE","type":"StartBlock","disabled":false,"name":"Start","displayName":"Start","comment":"","childId":"88752EC3-85F4-488E-A34D-02ED7FA40D14","inputs":[{"id":"run_mode","value":"triggered","type":"select","structure":{}},{"id":"async","value":"yes","type":"select","structure":{}},{"id":"","value":null,"type":"custom","structure":{}}],"settings":[{"id":"automations_censor_data","value":false,"type":"checkbox","structure":{}}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":78,"y":40},{"id":"95D85CB7-42CF-4AA7-B839-E2CBDFE9C796","type":"SnippetBlock","disabled":false,"name":"DoReload","displayName":"Qlik Cloud Services - Do Reload","comment":"Starta laddning och vänta tills laddningen är klar","childId":"ADF2C6CC-61FD-4A04-9C25-791F9230A3C8","inputs":[{"id":"29603390-e716-11ea-9e37-05e08ee32111","value":"{$.loop.item.AppId}","type":"string","structure":[]},{"id":"2ac9eef0-a677-11eb-aacc-8b755d0fe484","value":"Wait for reload to complete","type":"select","displayValue":"Wait for reload to complete","structure":[]},{"id":"6892c0c0-c795-11eb-9860-9dc8cb705e25","value":null,"type":"select","structure":[]},{"id":"ecebf340-c797-11eb-8671-53658babb1a1","value":null,"type":"select","structure":[]}],"settings":[{"id":"blendr_on_error","value":"stop","type":"select","structure":[]},{"id":"automations_censor_data","value":false,"type":"checkbox","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":198,"y":511,"datasourcetype_guid":"61a87510-c7a3-11ea-95da-0fb0c241e75c","snippet_guid":"b5dbb7a0-e715-11ea-b2bf-43bb35adee19"},{"id":"66316CE1-6229-43E4-A128-DAAEF127D470","type":"ForEachBlock","disabled":false,"name":"loop","displayName":"Loop","comment":"Loop over AppIds","childId":"06C24B60-6C2D-4C46-99F7-3E4C10D273A6","inputs":[{"id":"input","value":"{$.customCode}","type":"string","structure":[]}],"settings":[{"id":"automations_censor_data","value":false,"type":"checkbox","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":78,"y":400,"loopBlockId":"95D85CB7-42CF-4AA7-B839-E2CBDFE9C796"},{"id":"70881359-5AFB-4892-A887-6D8CC72CA830","type":"VariableBlock","disabled":false,"name":"ReloadIds","displayName":"Variable - ReloadIds","comment":"Store reload id in ReloadIds","childId":null,"inputs":[],"settings":[],"collapsed":[{"name":"loop","isCollapsed":false}],"x":284,"y":585,"variableGuid":"9CF0F1C2-CE1F-4C1D-9D7A-3846ACE5A0FB","operations":[{"id":"add_item","key":"F9E8F94F-9C22-4054-B18A-45444A94136D","name":"Add item to { variable }","value":"{$.loop.item}"}]},{"id":"ADF2C6CC-61FD-4A04-9C25-791F9230A3C8","type":"IfElseBlock","disabled":false,"name":"condition2","displayName":"Condition 2","comment":"Har app laddats klart  med status Success?","childId":"70881359-5AFB-4892-A887-6D8CC72CA830","inputs":[{"id":"conditions","value":{"mode":"all","conditions":[{"input1":"{$.DoReload.status}","input2":"SUCCEEDED","operator":"="}]},"type":"custom","structure":[]}],"settings":[],"collapsed":[{"name":"yes","isCollapsed":false},{"name":"no","isCollapsed":false}],"x":254,"y":576,"childTrueId":"60006138-DEB7-4A08-8A24-3E578F155C78","childFalseId":"4AEB8C74-F116-44D4-8664-EA3FBFECBDF4"},{"id":"070A697B-30A1-4F40-9CAB-5A3C41F40E37","type":"StopBlock","disabled":false,"name":"stop","displayName":"Stop","comment":"","childId":null,"inputs":[],"settings":[],"collapsed":[{"name":"loop","isCollapsed":false}],"x":300,"y":809},{"id":"4AEB8C74-F116-44D4-8664-EA3FBFECBDF4","type":"EndpointBlock","disabled":true,"name":"SendMail","displayName":"Mail - Send Mail","comment":"","childId":"B78D9DE4-1E62-4BC6-8001-3EBC4DA10F47","inputs":[{"id":"442845a0-cd00-11eb-9aa5-b966a68573b7","value":"aron.caselunghe@mindcamp.se","type":"string","structure":[]},{"id":"543f08c0-cd00-11eb-b9c6-af8e23cc2439","value":null,"type":"string","structure":[]},{"id":"5cbdb1d0-cd00-11eb-8afd-ddd4ecc002ac","value":null,"type":"string","structure":[]},{"id":"72cad1e0-cd00-11eb-aa1b-3f42c1d22e38","value":"Qlik tasks failed, Fridays","type":"string","structure":[]},{"id":"79af8c50-cd24-11eb-a019-dfdc9a7f7317","value":"text","type":"select","structure":[]},{"id":"7d225d00-cd00-11eb-8493-055760e8b45a","value":"Appen \"{$.loop.item.App}\" med appid  \"{$.loop.item.AppId}\" har failat!","type":"longtext","structure":[]},{"id":"bb841f10-3341-11ec-b9a3-9d6de0bb7866","value":null,"type":"custom","structure":[]}],"settings":[{"id":"datasource","value":null,"type":"select","structure":[]},{"id":"blendr_on_error","value":"stop","type":"select","structure":[]},{"id":"automations_censor_data","value":false,"type":"checkbox","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":349,"y":775,"datasourcetype_guid":"05407a80-ccfd-11eb-b098-7140f6ac27f4","endpoint_guid":"84a79bf0-ccff-11eb-a508-7d415a725ea7","endpoint_role":"create"},{"id":"0AD1C7BB-FF9F-4174-951B-AAE6252067CC","type":"CustomCodeBlock3","disabled":false,"name":"customCode","displayName":"Custom Code","comment":"Lista med appar som ska laddas en efter en.","childId":"B1C8EAC8-8E71-44B1-869D-3AE205F458CD","inputs":[{"id":"language","value":"nodejs","type":"select","displayValue":"Node.js 14.16","structure":[]},{"id":"inputs","value":[{"key":"Kedja","value":"{$.inputs.LaddKedja}"}],"type":"object","mode":"keyValue","structure":[]},{"id":"code","value":"//******************************************************************************************************************\n\n//Definiera lista med appar samt vilken kedja de ska ingå i\n//Om input är tomt laddas hela kedjan.\n//Om en app alltid ska laddas oavset input så ange [\"*\"]\n\nvar TblApps = [\n{\"App\":\"Extract_Styrfiler\", \t\t\"AppId\":\"fdaf7ad0-de32-4047-91b7-a1ce69ca172b\", \"Kedja\":[\"Styrfiler\"]},\n{\"App\":\"Refresh_Token_Fornox\", \t\t\"AppId\":\"1e628117-b317-4b8f-8ae6-afc1839eeef7\", \"Kedja\":[\"Fortnox\"] },\n{\"App\":\"Extract_Fortnox_REST\", \t\t\"AppId\":\"466282a7-b9f4-4e78-b5ce-ea4bc4cd8b97\", \"Kedja\":[\"Fortnox\"] },\n{\"App\":\"Transform_Fortnox_REST\",\t\"AppId\":\"7468f658-33b3-403e-9d52-f28f78a40671\", \"Kedja\":[\"*\"] },\n{\"App\":\"Ekonomiuppföljning\",\t\t\"AppId\":\"559df571-9757-40be-9565-1d04bca3e11a\", \"Kedja\":[\"*\"] },\n]\n\n// 20241010 Aron Caselunghe & ChatGPT\n//******************************************************************************************************************\n\n\n//Läser in sträng från inputfält\nvar vInputBlockStr = inputs.Kedja;\n\n//Om sträng är tom, ladda alla appar i kedjan ovan. Annars ladda bara de kedjor som angivits \nif (vInputBlockStr === null || vInputBlockStr.length === 0) {\n\tconsole.log(JSON.stringify(TblApps))\n} else {\n\n    // Konvertera till array\n    var vLaddkedjaInput = vInputBlockStr.split('|');\n\n\t//Filtera bara fram de appar som ska laddas om\n    var filteredTblApps = TblApps.filter(app => \n        app.Kedja.some(kedjaItem => vLaddkedjaInput.includes(kedjaItem)) || \n    app.Kedja.includes(\"*\")\n                                                                                                             \n);\n \nconsole.log(JSON.stringify(filteredTblApps, null, 2));\n  \n}\n\n\n\n","type":"code","structure":[]}],"settings":[{"id":"blendr_on_error","value":"stop","type":"select","structure":[]},{"id":"automations_censor_data","value":false,"type":"checkbox","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":78,"y":400},{"id":"81508860-1A01-4838-BF17-01CA9710756F","type":"EndpointBlock","disabled":true,"name":"SendMail2","displayName":"Mail - Send Mail 2","comment":"","childId":null,"inputs":[{"id":"442845a0-cd00-11eb-9aa5-b966a68573b7","value":"aron.caselunghe@mindcamp.se","type":"string","structure":[]},{"id":"543f08c0-cd00-11eb-b9c6-af8e23cc2439","value":null,"type":"string","structure":[]},{"id":"5cbdb1d0-cd00-11eb-8afd-ddd4ecc002ac","value":null,"type":"string","structure":[]},{"id":"72cad1e0-cd00-11eb-aa1b-3f42c1d22e38","value":"Qlik tasks failed, Fridays","type":"string","structure":[]},{"id":"79af8c50-cd24-11eb-a019-dfdc9a7f7317","value":"90ff46f0-cd24-11eb-bda1-0f1c7c213bfb","type":"select","displayValue":"html","structure":[]},{"id":"7d225d00-cd00-11eb-8493-055760e8b45a","value":"App failed:\n{$.loop.item}","type":"longtext","structure":[]},{"id":"bb841f10-3341-11ec-b9a3-9d6de0bb7866","value":null,"type":"custom","structure":[]}],"settings":[{"id":"datasource","value":null,"type":"select","structure":[]},{"id":"blendr_on_error","value":"stop","type":"select","structure":[]},{"id":"automations_censor_data","value":false,"type":"checkbox","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":114,"y":1549,"datasourcetype_guid":"05407a80-ccfd-11eb-b098-7140f6ac27f4","endpoint_guid":"84a79bf0-ccff-11eb-a508-7d415a725ea7","endpoint_role":"create"},{"id":"54D314DD-B36F-4DC5-88D7-8945E68AADBC","type":"ShowBlock","disabled":false,"name":"output3","displayName":"Output 3","comment":"","childId":"070B9466-01A3-46F5-96A9-44E8D87CE435","inputs":[{"id":"input","value":"{$.loop.item}","type":"string","structure":[]}],"settings":[{"id":"display_mode","value":"add","type":"select","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":357,"y":1194},{"id":"60006138-DEB7-4A08-8A24-3E578F155C78","type":"ShowBlock","disabled":false,"name":"output2","displayName":"Output 2","comment":"","childId":null,"inputs":[{"id":"input","value":"{$.loop.item}","type":"string","structure":[]}],"settings":[{"id":"display_mode","value":"add","type":"select","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":318,"y":711},{"id":"B1C8EAC8-8E71-44B1-869D-3AE205F458CD","type":"ShowBlock","disabled":false,"name":"output","displayName":"Output","comment":"","childId":"66316CE1-6229-43E4-A128-DAAEF127D470","inputs":[{"id":"input","value":"Appar som laddats:","type":"string","structure":[]}],"settings":[{"id":"display_mode","value":"add","type":"select","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":301,"y":629},{"id":"B78D9DE4-1E62-4BC6-8001-3EBC4DA10F47","type":"ShowBlock","disabled":false,"name":"output4","displayName":"Output 4","comment":"","childId":"54D314DD-B36F-4DC5-88D7-8945E68AADBC","inputs":[{"id":"input","value":"App som failat:","type":"string","structure":[]}],"settings":[{"id":"display_mode","value":"add","type":"select","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":364,"y":960},{"id":"070B9466-01A3-46F5-96A9-44E8D87CE435","type":"EndpointBlock","disabled":false,"name":"sendMessage","displayName":"Slack - Send Message","comment":"","childId":"070A697B-30A1-4F40-9CAB-5A3C41F40E37","inputs":[{"id":"89579ea0-c548-11eb-b9e0-9fea01e8ca23","value":"C032BUCDL15","type":"string","displayValue":"qlikcloudautomations","structure":[]},{"id":"8961fc70-c548-11eb-8ae2-f728bc67e19f","value":"Appen \"{$.loop.item.App}\" med appid  \"{$.loop.item.AppId}\" har failat!","type":"string","structure":[]},{"id":"896a8470-c548-11eb-9a4c-430357e86626","value":"QlikBotAutoMedeley","type":"string","structure":[]},{"id":"8970c910-c548-11eb-bd5b-594189a86540","value":null,"type":"string","structure":[]},{"id":"8977a3c0-c548-11eb-ac6d-918c14d2f88c","value":null,"type":"string","structure":[]},{"id":"8c4cbdf0-cd1c-11eb-af0e-e595e2810f0d","value":null,"type":"string","structure":[]},{"id":"ecce34c0-cd1c-11eb-b6e4-139d5ce8c99e","value":null,"type":"select","structure":[]}],"settings":[{"id":"datasource","value":"63168590-56f4-4112-ae5c-8f68143c9ad2","type":"select","structure":[]},{"id":"blendr_on_error","value":"stop","type":"select","structure":[]},{"id":"automations_censor_data","value":false,"type":"checkbox","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":374,"y":1219,"datasourcetype_guid":"0d86ee8a-27c0-11ea-921c-022e6b5ea1e2","endpoint_guid":"893cc900-c548-11eb-b967-a9fc4c267c43","endpoint_role":"create"},{"id":"06C24B60-6C2D-4C46-99F7-3E4C10D273A6","type":"ShowBlock","disabled":false,"name":"output5","displayName":"Output 5","comment":"","childId":"81508860-1A01-4838-BF17-01CA9710756F","inputs":[{"id":"input","value":"Laddkedja klar. Allt laddat korrekt","type":"string","structure":[]}],"settings":[{"id":"display_mode","value":"add","type":"select","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":75,"y":1788},{"id":"88752EC3-85F4-488E-A34D-02ED7FA40D14","type":"FormBlock","disabled":false,"name":"inputs","displayName":"Inputs","comment":"","childId":"0AD1C7BB-FF9F-4174-951B-AAE6252067CC","inputs":[],"settings":[{"id":"persist_data","value":"no","type":"select","displayValue":"No","structure":[]},{"id":"automations_censor_data","value":false,"type":"checkbox","structure":[]}],"collapsed":[{"name":"loop","isCollapsed":false}],"x":-291,"y":260,"form":[{"id":"inputs-input-0","type":"input","label":"LaddKedja","order":0,"values":null,"options":[],"helpText":"Ange laddkedjor. Separera med |. Uteblivet svar laddar allt","isRequired":false}],"persistData":"no"}],"variables":[{"guid":"41A391A5-86E9-4FF1-8A42-2C6BABD72AEA","name":"AppIds","type":"list"},{"guid":"9CF0F1C2-CE1F-4C1D-9D7A-3846ACE5A0FB","name":"ReloadIds","type":"list"},{"guid":"729D458A-2FDC-4E54-8900-6ADE573A0EAF","name":"vLaddKedja","type":"string"}]}